Installation d'un serveur WordPress avec Lighttpd, MariaDB et PHP sur Arch Linux

Pour mettre en place ce site sans utiliser Apache ou Nginx, voici les services nécessaires et leur rôle :

1. Lighttpd (Le Serveur Web)
   Contrairement à Apache qui peut tout faire, Lighttpd est conçu pour être léger et rapide. Cependant, il ne sait pas exécuter de code PHP lui-même. Son rôle est de recevoir les requêtes des visiteurs (HTTP) et de servir les fichiers statiques (images, CSS).

2. PHP-FPM (FastCGI Process Manager)
   C'est le service crucial qui manque souvent dans la compréhension initiale. Puisque Lighttpd ne gère pas le PHP, il agit comme un "passe-plat". Lorsqu'une page WordPress est demandée, Lighttpd transmet la requête à PHP-FPM. C'est PHP-FPM qui exécute le code WordPress, génère la page HTML finale, et la renvoie à Lighttpd.

3. MariaDB (La Base de Données)
   WordPress a besoin de stocker ses articles, configurations et utilisateurs. Il ne le fait pas dans des fichiers texte, mais dans une base de données relationnelle. MariaDB est le service qui gère ce stockage et répond aux requêtes de WordPress (via PHP).

Résumé de la "Stack" technique :
   Client -> Lighttpd -> (via FastCGI) -> PHP-FPM -> (via extensions PHP) -> MariaDB

---

### Étapes d'installation et de configuration sur Arch Linux

Voici la procédure étape par étape pour installer et configurer votre pile Lighttpd + MariaDB + PHP-FPM sur Arch Linux.

### Étape 1 : Installation des paquets
Installez les logiciels et les extensions PHP requises pour WordPress.

```bash
sudo pacman -Syu lighttpd mariadb php php-fpm php-gd php-intl php-mysql
```

### Étape 2 : Configuration de PHP
WordPress a besoin de certaines extensions qui sont désactivées par défaut sur Arch.

1.  Ouvrez le fichier de configuration PHP :
    ```bash
    sudo nano /etc/php/php.ini
    ```
2.  Recherchez les lignes suivantes et **retirez le point-virgule (;)** au début pour les activer :
    ```ini
    extension=gd
    extension=iconv
    extension=mysqli
    extension=pdo_mysql
    extension=zip
    ```
3.  Sauvegardez et quittez (`Ctrl+O`, `Enter`, `Ctrl+X`).

### Étape 3 : Initialisation et Configuration de MariaDB
1.  Initialisez les fichiers système de la base de données :
    ```bash
    sudo mariadb-install-db --user=mysql --basedir=/usr --datadir=/var/lib/mysql
    ```
2.  Démarrez le service MariaDB :
    ```bash
    sudo systemctl start mariadb
    ```
3.  Connectez-vous (en tant que root) pour créer la base de données de WordPress :
    ```bash
    sudo mariadb
    ```
4.  Dans l'invite SQL qui s'affiche, tapez ces commandes une par une :
    ```sql
    CREATE DATABASE wordpress;
    CREATE USER 'wp_user'@'localhost' IDENTIFIED BY 'motdepasse_solide';
    GRANT ALL PRIVILEGES ON wordpress.* TO 'wp_user'@'localhost';
    FLUSH PRIVILEGES;
    EXIT;
    ```

### Étape 4 : Configuration de Lighttpd avec PHP-FPM
Il faut dire à Lighttpd d'envoyer les fichiers `.php` au service PHP-FPM.

1.  Ouvrez le fichier de configuration de Lighttpd :
    ```bash
    sudo nano /etc/lighttpd/lighttpd.conf
    ```
2.  Dans la section `server.modules`, assurez-vous que `"mod_fastcgi"` est décommenté (ou ajoutez-le s'il n'y est pas).
3.  Ajoutez ce bloc de configuration à la fin du fichier pour lier PHP-FPM :
    ```lighttpd
    fastcgi.server = ( ".php" =>
      ((
        "socket" => "/run/php-fpm/php-fpm.sock",
        "broken-scriptfilename" => "enable"
      ))
    )
    ```
4.  (Optionnel) Vérifiez que `server.document-root` pointe bien vers `"/srv/http/"` (c'est le défaut).

### Étape 5 : Démarrage des services
Activez les services pour qu'ils démarrent avec le PC et lancez-les maintenant :

```bash
sudo systemctl enable --now lighttpd php-fpm mariadb
```

### Étape 6 : Installation de WordPress
Enfin, récupérez WordPress et placez-le dans le dossier du serveur.

```bash
cd /srv/http/
sudo wget https://wordpress.org/latest.tar.gz
sudo tar -xzvf latest.tar.gz
sudo mv wordpress/* .
sudo rm -rf wordpress latest.tar.gz
sudo chown -R http:http /srv/http/
```

Une fois ces étapes terminées, vous pourrez accéder à l'installation en allant sur `http://localhost` dans votre navigateur.

Dites-moi quand vous êtes prêt ou si vous bloquez sur une étape